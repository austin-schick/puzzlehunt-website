<!DOCTYPE html>
<html><head><title>Tetris for Intro/Intermediate Programmers (Fall 2017 update)</title></head>
<body bgcolor="#ADDEFA">

<hr color="#e88100">
<font face="Arial"><b>Tetris for Intro/Intermediate Programmers (Fall 2017 update)<br>
Step 6:&nbsp; Dropping and Placing the fallingPiece on the Board</b></font><hr color="#e88100">
<ul>
	<li>
	<p align="left">We are now ready to have the falling piece respond to time 
	events by dropping one row on each call to timerFired.</p></li>
	<li>
	<p align="left">To start, we can have our timerFired function call moveFallingPiece(data, +1, 0), just as we do in response to a down-arrow 
	key press.<br>This is not a bad start, but when it gets to the bottom, it just sits there (until we hit a 
	non-arrow key to artificially reset the falling piece).</p></li><li><p align="left">Once
again, when the fallingPiece gets to the bottom, it simply stops
falling and sits there -- it does not&nbsp;get placed on the
board.&nbsp; To remedy this, we first need to know that it
happened!&nbsp; That requires a small change to some code we have
written.&nbsp; We will change moveFallingPiece so that&nbsp;now it
returns True if the move occurred, and False
otherwise for any reason (the piece moved off the board, or the piece
collided with something on the board).&nbsp; This requires only a small
change to our code.&nbsp;
Once we have done this, our timerFired can test the return value
from moveFallingPiece to determine if the move failed.&nbsp; In that
case, we will use top-down design and call a function (that we are
about to write) to place the falling piece on the board, followed by a
call to newFallingPiece, to start a new piece falling from the top.</p></li>
	<li><p align="left">Writing placeFallingPiece:<font color="#800000" face="Courier New" size="2"><br>
	</font>This
function (which only takes data, and not canvas) is quite similar to drawFallingPiece, only rather than draw
the cells, we load the corresponding positions on the board with the
fallingPieceColor.&nbsp; In this way, the piece is placed on the board.</p></li>
	<li>Once you get this working, our game springs to life. &nbsp;This works quite well!&nbsp; But now we see another problem:&nbsp; 
	the game never ends.&nbsp; The pieces pile up to the top, but then they just 
	keep pouring out.&nbsp; We should fix this!<br><br></li><li>When should the game end?&nbsp; When we place a falling 
	piece and it is <i>immediately</i> illegal.&nbsp; We can test for this in 
	our timerFired, right after we call newFallingPiece.<br><br></li><li>But
what should we do when the game has ended?&nbsp; Here, we will simply
create a new variable, data.isGameOver, and set it to True.&nbsp; Then we will
change&nbsp;the appropriate draw function to test this variable and if it is True simply
draw a suitable message.&nbsp; Finally, we will let the user start a
new game at any time by hitting 'r' for 'restart', and calling the init
function in response.&nbsp; Remember also to disable your step and key
event functions when the game is over until the user restarts a new game
(though, again, be sure your keyPressed continues to look for
the 'r' key, even the the game is over, or else it will be impossible
to restart!).<br><br></li>
	
	
	<li>
	At this time we will remove our test code from prior steps, both the call to
	newFallingPiece in response to a non-arrow key press and the four corners in init.<br></li><br>


<li>At the end of this stage, your Tetris board should be able to do this:<br><br>
	<img src="pix/step-6.gif" border="0" width="250">
</li>
	</ul>

<hr color="#e88100">
<table style="border-collapse: collapse;" id="table2" border="0" cellpadding="0" width="100%">
	<tbody><tr>
		<td width="33%">&nbsp;</td>
		<td width="33%">
		<p align="center">
<a href="2_5_RotatingTheFallingPiece.html"><img src="pix/previous.gif" border="0" height="15" width="73"></a>
<a href="TetrisForIntroIntermediateProgrammers.html"><img src="pix/home.gif" border="0" height="16" width="19"></a>
<a href="2_7_RemovingFullRows.html"><img src="pix/next.gif" border="0" height="16" width="73"></a></p></td>
		<td width="33%">
		<p align="right"><font face="Arial" size="2">David Kosbie<br>
Carnegie Mellon University<br>
<a href="mailto:koz@cmu.edu">koz@cmu.edu</a></font></p></td>
	</tr>
</tbody></table>

<hr color="#e88100">

</body></html>